################################################
# Author: ditekSHen
# Reference: https://github.com/ditekshen/detection
# ##############################################
#
################################################
# INDICATOR DOCUMENTS
################################################
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-DOCUMENT Ancalog RTF exploit builder document detected"; flow:to_client,established; flowbits:isset,file.rtf; file_data; content:"|5C|*|5C|ancalog"; nocase; fast_pattern:only; metadata:ruleset community, service ftp-data, service http, service imap, service pop3, yara INDICATOR_RTF_Ancalog_Exploit_Builder_Document, clamav INDICATOR.RTF.AncalogExploitBuilderDocument; classtype:trojan-activity; sid:910000; rev:1;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"INDICATOR-DOCUMENT Ancalog RTF exploit builder document detected"; flow:to_server,established; flowbits:isset,file.rtf; file_data; content:"|5C|*|5C|ancalog"; nocase; fast_pattern:only; metadata:ruleset community, service smtp, yara INDICATOR_RTF_Ancalog_Exploit_Builder_Document, clamav INDICATOR.RTF.AncalogExploitBuilderDocument; classtype:trojan-activity; sid:910001; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATE-DOCUMENT RTF document with Equation and BITSAdmin download attempt"; flow:to_client,established; flowbits:isset,filt.rtf|file.doc; file_data; content:"0200000002CE020000000000C000000000000046"; nocase; content:"6269747361646d696e"; nocase; metadata:ruleset community, service http, service imap, service pop3, service ftp-data, yara INDICATOR_RTF_Equation_BITSAdmin_Downloader, clamav INDICATOR.RTF.EquationBITSAdminDownloader; classtype:trojan-activity; sid:910002; rev:1;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"INDICATE-DOCUMENT RTF document with Equation and BITSAdmin download attempt"; flow:to_server,established; flowbits:isset,filt.rtf|file.doc; file_data; content:"0200000002CE020000000000C000000000000046"; nocase; content:"6269747361646d696e"; nocase; metadata:ruleset community, service smtp, yara INDICATOR_RTF_Equation_BITSAdmin_Downloader, clamav INDICATOR.RTF.EquationBITSAdminDownloader; classtype:trojan-activity; sid:910003; rev:1;)
################################################
# MALWARE
################################################
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE-CNC Win.Trojan.RevengeRAT information outbound connection"; flow:to_server,established; content:"InformationRevenge-RAT"; fast_pattern:only; metadata:ruleset community, yara MALWARE_Win_RevengeRAT, clamav MALWARE.Win.RevengeRAT; classtype:trojan-activity; sid:920000; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE-CNC Win.Trojan.RevengeRAT keep alive outbound connection"; flow:to_server,established; content:"keepAlivePing!!@#%"; fast_pattern:only; metadata:ruleset community, yara MALWARE_Win_RevengeRAT, clamav MALWARE.Win.RevengeRAT; classtype:trojan-activity; sid:920001; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE-CNC Win.Trojan.RevengeRAT PNC outbound connection"; flow:to_server,established; content:"PNC!@#%"; fast_pattern:only; metadata:ruleset community, yara MALWARE_Win_RevengeRAT, clamav MALWARE.Win.RevengeRAT; classtype:trojan-activity; sid:920002; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE-CNC Win.Trojan.XpertRAT outbound connection"; flow:to_server,established; content:"400|7C|root|7C|"; fast_pattern:only; metadata:ruleset community, yara MALWARE_Win_XpertRAT, clamav MALWARE.Win.XpertRAT; classtype:trojan-activity; sid:920003; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE-CNC Win.Trojan.XpertRAT outbound connection"; flow:to_server,established; dsize:10; content:"|7C|root|7C|"; offset:3; depth:6; fast_pattern; isdataat:!1,relative; metadata:ruleset community, yara MALWARE_Win_XpertRAT, clamav MALWARE.Win.XpertRAT; classtype:trojan-activity; sid:920004; rev:2;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE-CNC Win.Trojan.XpertRAT outbound connection"; flow:to_server,established; content:"|7C|root|7C|"; within:9; fast_pattern; pcre:"/\d{1,3}\x7croot\x7c\d/"; metadata:ruleset community, yara MALWARE_Win_XpertRAT, clamav MALWARE.Win.XpertRAT; classtype:trojan-activity; sid:920005; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE-CNC Win.Trojan.XpertRAT inbound connection"; flow:to_client,established; dsize:<12; content:"400|7C|0|7C|"; content:"@#@!"; distance:1; metadata:ruleset community, yara MALWARE_Win_XpertRAT, clamav MALWARE.Win.XpertRAT; classtype:trojan-activity; sid:920006; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"MALWARE-CNC Win.Trojan.Agent downloader outbound connection"; flow:to_server,established; content:"User-Agent: Mozilla/5.0 Gecko/41.0 Firefox/41.0|0D 0A|"; fast_pattern:only; http_header; content:"/?v="; http_uri; content:"&g="; http_uri; metadata:ruleset community, yara MALWARE_Win_DA1, clamav MALWARE.Win.DA1; classtype:trojan-activity; sid:920007; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"MALWARE-CNC Win.Ransomware.VSSDestroy/Matrix variant post-infection outbound connection"; flow:to_server,established; content:"/addrecord.php"; fast_pattern:only; http_uri; content:"apikey="; http_uri; content:"&compuser="; http_uri; content:"&sid="; http_uri; content:"&phase="; http_uri; metadata:ruleset community, service http, yara MALWARE_Win_VSSDestroy, clamav MALWARE.Win.VSSDestroy; classtype:trojan-activity; sid:920008; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"MALWARE-CNC Win.Ransomware.VSSDestroy/Matrix variant post-infection outbound connection"; flow:to_server,established; content:"/addrec.php"; fast_pattern:only; http_uri; content:"apikey="; http_uri; content:"&compuser="; http_uri; content:"&sid="; http_uri; content:"&phase="; http_uri; metadata:ruleset community, service http, yara MALWARE_Win_VSSDestroy, clamav MALWARE.Win.VSSDestroy; classtype:trojan-activity; sid:920009; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE-CNC Win.Trojan.WSHRAT variant outbound connection"; flow:to_server,established; content:"User-Agent: WSHRAT"; fast_pattern:only; metadata:ruleset community, service http, yara MALWARE_Win_WSHRAT, clamav MALWARE.Win.WSHRAT; classtype:trojan-activity; sid:920010; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE-CNC Win.Trojan.WSHRAT variant outbound connection"; flow:to_server,established; content:"user-agent:: <|7C|>"; fast_pattern:only; metadata:ruleset community, service http, yara MALWARE_Win_WSHRAT, clamav MALWARE.Win.WSHRAT; classtype:trojan-activity; sid:920011; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE-CNC Win.Trojan.WSHRAT variant second stage outbound connection"; content: "GET"; http_method; content:"/open-keylogger HTTP/1."; within:23; metadata:ruleset community, service http, yara MALWARE_Win_WSHRAT, clamav MALWARE.Win.WSHRAT; classtype:trojan-activity; sid:920012; rev:1;)
