################################################
# Author: ditekSHen
# Reference: https://github.com/ditekshen/detection
# ##############################################
#
################################################
# INDICATOR DOCUMENTS
################################################
alert file ( msg:"INDICATOR-DOCUMENT Ancalog RTF exploit builder document detected"; file_type:"RTF"; file_data; content:"|5C|*|5C|ancalog",fast_pattern,nocase; service:http, smtp; rem:"yara:INDICATOR_RTF_Ancalog_Exploit_Builder_Document, clamav:INDICATOR.RTF.AncalogExploitBuilderDocument, tlp:white "; classtype:trojan-activity; sid:910000; rev:1; )
alert file ( msg:"INDICATOR-DOCUMENT Exploit RTF document Equation-BITSAdmin downloader detected"; file_type:"RTF"; file_data; content:"0200000002ce020000000000c000000000000046",fast_pattern,nocase; content:"6269747361646d696e",nocase; service:http, smtp; rem:"yara:INDICATOR_RTF_Equation_BITSAdmin_Downloader, clamav:INDICATOR.RTF.EquationBITSAdminDownloader, tlp:white "; classtype:trojan-activity; sid:910001; rev:1; )
alert file ( msg:"INDICATOR-DOCUMENT Exploit RTF document Equation-PowerShell downloader detected"; file_type:"RTF"; file_data; content:"0200000002ce020000000000c000000000000046",fast_pattern,nocase; content:"706f7765727368656c6c",nocase; service:http, smtp; rem:"yara:INDICATOR_RTF_Equation_PowerShell_Downloader, clamav:INDICATOR.RTF.EquationPowerShellDownloader, tlp:white "; classtype:trojan-activity; sid:910002; rev:1; )
alert file ( msg:"INDICATOR-DOCUMENT Exploit RTF document Equation-CertUtil downloader detected"; file_type:"RTF"; file_data; content:"0200000002ce020000000000c000000000000046",fast_pattern,nocase; content:"636572747574696c",nocase; service:http, smtp; rem:"yara:INDICATOR_RTF_Equation_CertUtil_Downloader, clamav:INDICATOR.RTF.EquationCertUtilDownloader, tlp:white "; classtype:trojan-activity; sid:910003; rev:1; )
################################################
# MALWARE
################################################
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"MALWARE-CNC Win.Trojan.RevengeRAT information outbound connection"; flow:to_server,established; content:"InformationRevenge-RAT",fast_pattern; rem:"yara:MALWARE_Win_RevengeRAT, clamav:MALWARE.Win.RevengeRAT"; classtype:trojan-activity; sid:920000; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"MALWARE-CNC Win.Trojan.RevengeRAT keep alive outbound connection"; flow:to_server,established; content:"keepAlivePing!!@#%",fast_pattern; rem:"yara:MALWARE_Win_RevengeRAT, clamav:MALWARE.Win.RevengeRAT"; classtype:trojan-activity; sid:920001; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"MALWARE-CNC Win.Trojan.RevengeRAT PNC outbound connection"; flow:to_server,established; content:"PNC!@#%",fast_pattern; rem:"yara:MALWARE_Win_RevengeRAT, clamav:MALWARE.Win.RevengeRAT"; classtype:trojan-activity; sid:920002; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"MALWARE-CNC Win.Trojan.XpertRAT outbound connection"; flow:to_server,established; content:"400|7C|root|7C|",fast_pattern; rem:"yara:MALWARE_Win_XpertRAT, clamav:MALWARE.Win.XpertRAT"; classtype:trojan-activity; sid:920003; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"MALWARE-CNC Win.Trojan.XpertRAT outbound connection"; flow:to_server,established; dsize:10; content:"|7C|root|7C|",offset 3,depth 6,fast_pattern; isdataat:!1,relative; rem:"yara:MALWARE_Win_XpertRAT, clamav:MALWARE.Win.XpertRAT"; classtype:trojan-activity; sid:920004; rev:2; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"MALWARE-CNC Win.Trojan.XpertRAT outbound connection"; flow:to_server,established; content:"|7C|root|7C|",within 9,fast_pattern; pcre:"/\d{1,3}\x7croot\x7c\d/"; rem:"yara:MALWARE_Win_XpertRAT, clamav:MALWARE.Win.XpertRAT"; classtype:trojan-activity; sid:920005; rev:1; )
alert tcp $EXTERNAL_NET any -> $HOME_NET any ( msg:"MALWARE-CNC Win.Trojan.XpertRAT inbound connection"; flow:to_client,established; dsize:<12; content:"400|7C|0|7C|"; content:"@#@!",distance 1; rem:"yara:MALWARE_Win_XpertRAT, clamav:MALWARE.Win.XpertRAT"; classtype:trojan-activity; sid:920006; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS ( msg:"MALWARE-CNC Win.Trojan.Agent downloader outbound connection"; flow:to_server,established; http_header:field user-agent; content:"Mozilla/5.0 Gecko/41.0 Firefox/41.0",fast_pattern; http_uri; content:"/?v="; content:"&g="; rem:"yara:MALWARE_Win_DA1, clamav:MALWARE.Win.DA1"; classtype:trojan-activity; sid:920007; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS ( msg:"MALWARE-CNC Win.Ransomware.VSSDestroy/Matrix variant post-infection outbound connection"; flow:to_server,established; http_uri; content:"/addrecord.php",fast_pattern; content:"apikey="; content:"&compuser="; content:"&sid="; content:"&phase="; rem:"yara:MALWARE_Win_VSSDestroy, clamav:MALWARE.Win.VSSDestroy"; classtype:trojan-activity; sid:920008; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS ( msg:"MALWARE-CNC Win.Ransomware.VSSDestroy/Matrix variant post-infection outbound connection"; flow:to_server,established; http_uri; content:"/addrec.php",fast_pattern; content:"apikey="; content:"&compuser="; content:"&sid="; content:"&phase="; rem:"yara:MALWARE_Win_VSSDestroy, clamav:MALWARE.Win.VSSDestroy"; classtype:trojan-activity; sid:920009; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"MALWARE-CNC Win.Trojan.WSHRAT variant outbound connection"; flow:to_server,established; http_header:field user-agent; content:"WSHRAT",fast_pattern; rem:"yara:MALWARE_Win_WSHRAT, clamav:MALWARE.Win.WSHRAT"; classtype:trojan-activity; sid:920010; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"MALWARE-CNC Win.Trojan.WSHRAT variant outbound connection"; flow:to_server,established; http_header; content:"user-agent:: <|7C|>",fast_pattern; rem:"yara:MALWARE_Win_WSHRAT, clamav:MALWARE.Win.WSHRAT"; classtype:trojan-activity; sid:920011; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"MALWARE-CNC Win.Trojan.WSHRAT variant second stage outbound connection"; http_method; content: "GET"; content:"/open-keylogger HTTP/1.",within 23; rem:"yara:MALWARE_Win_WSHRAT, clamav:MALWARE.Win.WSHRAT"; classtype:trojan-activity; sid:920012; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"INDICATOR-COMPROMISE Koadic framework C&C outbound connection"; flow:to_server,established; http_header; content:"encoder:"; content:"shellchcp:"; rem:"yara:MALWARE_DOC_KoadicDOC, yara:MALWARE_BAT_KoadicBAT, yara:MALWARE_JS_KoadicJS, clamav:MALWARE.DOC.KoadicDOC, clamav:MALWARE.BAT.KoadicBAT, clamav:MALWARE.JS.KoadicJS"; reference:url,attack.mitre.org/software/S0250; classtype:trojan-activity; sid:920013; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"INDICATOR-COMPROMISE Koadic framework C&C outbound connection"; flow:to_server,established; http_header; content:"errdesc:"; content:"errno:"; content:"errname:"; rem:"yara:MALWARE_DOC_KoadicDOC, yara:MALWARE_BAT_KoadicBAT, yara:MALWARE_JS_KoadicJS, clamav:MALWARE.DOC.KoadicDOC, clamav:MALWARE.BAT.KoadicBAT, clamav:MALWARE.JS.KoadicJS"; reference:url,attack.mitre.org/software/S0250; classtype:trojan-activity; sid:920014; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"INDICATOR-COMPROMISE Koadic framework C&C download payload outbound connection"; flow:to_server,established; http_header; content:"X-UploadFileJob:",fast_pattern; content:"Referer:"; pcre:"/X-UploadFileJob:\s(true|false)\x0d\x0a/"; rem:"yara:MALWARE_DOC_KoadicDOC, yara:MALWARE_BAT_KoadicBAT, yara:MALWARE_JS_KoadicJS, clamav:MALWARE.DOC.KoadicDOC, clamav:MALWARE.BAT.KoadicBAT, clamav:MALWARE.JS.KoadicJS"; reference:url,attack.mitre.org/software/S0250; classtype:trojan-activity; sid:920015; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"INDICATOR-COMPROMISE Koadic framework C&C outbound connection"; flow:to_server,established; http_uri; content:"./mshtml,RunHTMLApplication",fast_pattern; content:"/html?"; rem:"yara:MALWARE_DOC_KoadicDOC, yara:MALWARE_BAT_KoadicBAT, yara:MALWARE_JS_KoadicJS, clamav:MALWARE.DOC.KoadicDOC, clamav:MALWARE.BAT.KoadicBAT, clamav:MALWARE.JS.KoadicJS"; reference:url,attack.mitre.org/software/S0250; classtype:trojan-activity; sid:920016; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"INDICATOR-COMPROMISE Koadic framework C&C outbound connection"; flow:to_server,established; http_uri; content:"=stage|3B|"; content:"/html?"; http_header; content:"Referer:"; rem:"yara:MALWARE_DOC_KoadicDOC, yara:MALWARE_BAT_KoadicBAT, yara:MALWARE_JS_KoadicJS, clamav:MALWARE.DOC.KoadicDOC, clamav:MALWARE.BAT.KoadicBAT, clamav:MALWARE.JS.KoadicJS"; reference:url,attack.mitre.org/software/S0250; classtype:trojan-activity; sid:920017; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET any ( msg:"INDICATOR-COMPROMISE Koadic framework Windows host information exfiltration"; flow:to_server,established; http_client_body; content:"~~~Windows"; content:"~~~AMD",distance 0; content:"~~~C:|5C|Users",distance 0; rem:"yara:MALWARE_DOC_KoadicDOC, yara:MALWARE_BAT_KoadicBAT, yara:MALWARE_JS_KoadicJS, clamav:MALWARE.DOC.KoadicDOC, clamav:MALWARE.BAT.KoadicBAT, clamav:MALWARE.JS.KoadicJS"; reference:url,attack.mitre.org/software/S0250; classtype:trojan-activity; sid:920018; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS ( msg:"MALWARE-CNC Win.Trojan.M00nD3v keylogger outbound HTTP connection"; flow:to_server,established; http_client_body; content:"token="; content:"&name="; content:"&type="; content:"&data="; http_header; content:!"User-Agent"; metadata:ruleset community, service http; rem:"yara:MALWARE_Win_M00nD3v, clamav:MALWARE.Win.M00nD3v"; classtype:trojan-activity; sid:920019; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.M00nD3v keylogger outbound SMTP connection - Execution"; flow:to_server,established; content:"Subject: Execution Alert!",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_M00nD3v, clamav:MALWARE.Win.M00nD3v"; classtype:trojan-activity; sid:920020; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.M00nD3v keylogger outbound SMTP connection - Password"; flow:to_server,established; content:"Subject: Password Monitoring",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_M00nD3v, clamav:MALWARE.Win.M00nD3v"; classtype:trojan-activity; sid:920021; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.M00nD3v keylogger outbound SMTP connection - Keystroke"; flow:to_server,established; content:"Subject: KeyStroke Monitoring",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_M00nD3v, clamav:MALWARE.Win.M00nD3v"; classtype:trojan-activity; sid:920022; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.M00nD3v keylogger outbound SMTP connection - Screen"; flow:to_server,established; content:"Subject: Screen Monitoring",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_M00nD3v, clamav:MALWARE.Win.M00nD3v"; classtype:trojan-activity; sid:920023; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.M00nD3v keylogger outbound SMTP connection - Webcam"; flow:to_server,established; content:"Subject: WebCam Monitoring",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_M00nD3v, clamav:MALWARE.Win.M00nD3v"; classtype:trojan-activity; sid:920024; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.M00nD3v keylogger outbound SMTP connection - Clipboard"; flow:to_server,established; content:"Subject: Clipboard Monitoring",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_M00nD3v, clamav:MALWARE.Win.M00nD3v"; classtype:trojan-activity; sid:920025; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.M00nD3v keylogger outbound SMTP connection"; flow:to_server,established; content:"U3RlYWxlciBMb2dz",fast_pattern; content:"Subject: =?utf-8"; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_M00nD3v, clamav:MALWARE.Win.M00nD3v"; classtype:trojan-activity; sid:920026; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Phoenix/404keylogger variant outbound SMTP connection"; flow:to_server,established; content:"Subject: "; content:"PSWD |7C| Client Name:",fast_pattern,within 50; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Phoenix, clamav:MALWARE.Win.Phoenix"; classtype:trojan-activity; sid:920027; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Phoenix/404keylogger variant outbound SMTP connection"; flow:to_server,established; content:"Keylogger - Passwords -------|7C|",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Phoenix, clamav:MALWARE.Win.Phoenix"; classtype:trojan-activity; sid:920028; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Phoenix/404keylogger variant outbound SMTP connection"; flow:to_server,established; content:"|3B| name=|22|PXRecoveries |7C|",fast_pattern; content:".txt",within 30; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Phoenix, clamav:MALWARE.Win.Phoenix"; classtype:trojan-activity; sid:920029; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Phoenix/404keylogger variant outbound SMTP connection"; flow:to_server,established; content:"IP:"; content:"Owner Name:"; content:"OS Name:"; content:"Platform:"; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Phoenix, clamav:MALWARE.Win.Phoenix"; classtype:trojan-activity; sid:920030; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Phoenix/404keylogger outbound SMTP connection"; flow:to_server,established; content:"Subject: PSWD|7C|",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Phoenix, clamav:MALWARE.Win.Phoenix"; classtype:trojan-activity; sid:920031; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Phoenix/404keylogger outbound SMTP connection"; flow:to_server,established; content:"Subject: Logs|7C|",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Phoenix, clamav:MALWARE.Win.Phoenix"; classtype:trojan-activity; sid:920032; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Phoenix/404keylogger outbound SMTP connection"; flow:to_server,established; content:"Subject: Screenshot|7C|",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Phoenix, clamav:MALWARE.Win.Phoenix"; classtype:trojan-activity; sid:920033; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound SMTP connection"; flow:to_server,established; content:"- Passwords Logs -",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920034; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound SMTP connection"; flow:to_server,established; content:"- Keyboard Logs -",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920035; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound SMTP connection"; flow:to_server,established; content:"Subject: Logger - Server Ran",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920036; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound SMTP connection"; flow:to_server,established; content:"Subject: Logger|7C|",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920037; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound SMTP connection"; flow:to_server,established; content:"SGF3a0V5ZSBSZ",fast_pattern; content:"Subject: =?utf-8"; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920038; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound SMTP connection"; flow:to_server,established; content:"SGF3a0V5ZSBLZXlsb",fast_pattern; content:"Subject: =?utf-8"; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920039; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound SMTP connection"; flow:to_server,established; content:"Subject: HawkEye Keylogger",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920040; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound SMTP connection"; flow:to_server,established; content:"Subject: HawkEye Reborn",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920041; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET 21 ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound FTP connection"; flow:to_server,established; content:"STOR HawkEyeReborn",fast_pattern,depth 18; metadata:ruleset community, service ftp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920042; rev:1; )
alert tcp $HOME_NET any -> $SMTP_SERVERS 21 ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound FTP connection"; flow:to_server,established; content:"STORHawkEye",fast_pattern,depth 11; metadata:ruleset community, service ftp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920043; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET 21 ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound FTP connection"; flow:to_server,established; content:"STOR HawkEyeKeylogger",fast_pattern,depth 21; metadata:ruleset community, service ftp; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920044; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS ( msg:"MALWARE-CNC Win.Trojan.HawkEye outbound HTTP connection"; flow:to_server,established; http_client_body; content:"Secret="; content:"HWID=",nocase; content:"Name=",nocase; content:"OS=",nocase; content:"Type=",nocase; metadata:ruleset community, service http; rem:"yara:MALWARE_Win_HawkEyev9, clamav:MALWARE.Win.HawkEyev9"; classtype:trojan-activity; sid:920045; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.AspireLogger outbound SMTP connection"; flow:to_server,established; content:"Subject: AspireLogger [",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Aspire, clamav:MALWARE.Win.Aspire"; classtype:trojan-activity; sid:920046; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.AspireLogger outbound SMTP connection"; flow:to_server,established; content:"PC:"; content:"IP:",within 88; content:"Aspire"; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Aspire, clamav:MALWARE.Win.Aspire"; classtype:trojan-activity; sid:920047; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Orion keylogger outbound SMTP connection"; flow:to_server,established; content:"Subject: Orion Logger",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Orion, clamav:MALWARE.Win.Orion"; classtype:trojan-activity; sid:920048; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Orion keylogger outbound SMTP connection"; flow:to_server,established; content:"System Details |7C|=3D="; content:"=0D=0AComputer Name:"; content:"=0D=0ACountry Name:"; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_Orion, clamav:MALWARE.Win.Orion"; classtype:trojan-activity; sid:920049; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Firebird/Hive RAT outbound SMTP connection"; flow:to_server,established; content:"Subject: "; content:": PASSWORDS",within 150; metadata:ruleset community, service smtp; rem:"yara MALWARE_Win_FirebirdRAT, clamav MALWARE.Win.FirebirdRAT"; classtype:trojan-activity; sid:920050; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound SMTP connection"; flow:to_server,established; content:"Subject: "; content:"Passwords Recovered From:",fast_pattern,within 150; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920051; rev:2; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound SMTP connection"; flow:to_server,established; content:"Subject: "; content:"Screen Capture From: ",fast_pattern,within 150; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920052; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound SMTP connection"; flow:to_server,established; content:"Subject: "; content:" Recovered Accounts",fast_pattern,within 150; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920053; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound SMTP connection"; flow:to_server,established; content:"Subject: PW_",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920054; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound SMTP connection"; flow:to_server,established; content:"Subject: CO_",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920055; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound SMTP connection"; flow:to_server,established; content:"Subject: SC_",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920056; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound SMTP connection"; flow:to_server,established; content:"Subject: KL_",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920057; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET 21 ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound FTP connection"; flow:to_server,established; content:"STOR PW_",fast_pattern,depth 8; metadata:ruleset community, service ftp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920058; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET 21 ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound FTP connection"; flow:to_server,established; content:"STOR CO_",fast_pattern,depth 8; metadata:ruleset community, service ftp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920059; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET 21 ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound FTP connection"; flow:to_server,established; content:"STOR SC_",fast_pattern,depth 8; metadata:ruleset community, service ftp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920060; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET 21 ( msg:"MALWARE-CNC Win.Trojan.AgentTesla outbound FTP connection"; flow:to_server,established; content:"STOR KL_",fast_pattern,depth 8; metadata:ruleset community, service ftp; rem:"yara:MALWARE_Win_AgentTeslaV2, yara:MALWARE_Win_AgentTeslaV3, clamav:MALWARE.Win.AgentTeslaV2, clamav:MALWARE.Win.AgentTeslaV3"; classtype:trojan-activity; sid:920061; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.MassLogger outbound SMTP connection"; flow:to_server,established; content:"Subject: MassLogger |7C|",fast_pattern; metadata:ruleset community, service smtp; rem:"yara:MALWARE_Win_MassLogger, clamav:MALWARE.Win.MassLogger"; classtype:trojan-activity; sid:920062; rev:1; )
alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Generic keylogger outbound SMTP connection"; flow:to_server,established; content:"Subject: "; content: "Screen Capture",within 150; metadata:ruleset community, service smtp; classtype:trojan-activity; sid:920063; rev:1; )
#alert tcp $HOME_NET any -> $EXTERNAL_NET [25,26,587] ( msg:"MALWARE-CNC Win.Trojan.Generic keylogger outbound SMTP connection"; flow:to_server,established; content:"Subject: "; content: "Keylog",within 150; metadata:ruleset community, service smtp; classtype:trojan-activity; sid:920064; rev:1; )
alert http ( msg:"INDICATOR-DOCUMENT Doc.Trojan.ReconDoc outbound connection"; flow:to_server,established; http_uri; content:".php?id="; base64_decode:relative; base64_data; content:"document_name:"; content:"|7C|computer_name:"; content:"|7C|user_name:"; metadata:ruleset community, service http; classtype:trojan-activity; sid:920065; rev:1; )
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE-CNC Win.Trojan.QuasarRAT inbound SSL certificate"; flow:to_client,established; content:"|55 04 03 0C|"; content:"Quasar Server CA",fast_pattern,distance 1; metadata:ruleset community, service ssl, yara MALWARE_Win_QuasarRAT; classtype:trojan-activity; sid:920066; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE-CNC Win.Trojan.AsyncRAT inbound SSL certificate"; flow:to_client,established; content:"|55 04 03 0C|"; content:"AsyncRAT Server",fast_pattern,distance 1; metadata:ruleset community, service ssl; classtype:trojan-activity; sid:920067; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE-CNC Win.Trojan.OrcusRAT inbound SSL certificate"; flow:to_client,established; content:"|55 04 03|"; content:"Orcus Server|30|",fast_pattern,distance 2; metadata:ruleset community, service ssl; classtype:trojan-activity; sid:920068; rev:2;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE-CNC Win.Trojan.BitRAT inbound SSL certificate"; flow:to_client,established; content:"|55 04 03 0C|"; content:"BitRAT|30|",fast_pattern,distance 1; metadata:ruleset community, service ssl; classtype:trojan-activity; sid:920069; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE-CNC Win.Trojan.RevCode inbound SSL certificate"; flow:to_client,established; content:"|55 04 03 0C|"; content:"*.revcode.se|30|",fast_pattern,distance 1; metadata:ruleset community, service ssl; classtype:trojan-activity; sid:920070; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE-CNC Known malicious inbound SSL certificate"; flow:to_client,established; content:"|55 04 03 0C|";  content:"Server|30|",fast_pattern,distance 1; metadata:ruleset community, service ssl; classtype:trojan-activity; sid:920071; rev:1;)
################################################
# INDICATOR PACKED
################################################
alert file ( msg:"INDICATOR-PACKED Spices.Net packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"protected by 9Rays.Net Spices.Net Obfuscator",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_Spices"; classtype:policy-violation; sid:930000; rev:1; )
alert file ( msg:"INDICATOR-PACKED PS2EXE packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"PS2EXE",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_PS2EXE"; classtype:policy-violation; sid:930001; rev:1; )
alert file ( msg:"INDICATOR-PACKED ASPACK packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"|2E 61 73 70 61 63 6B 00 00|",nocase,fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_ASPack"; classtype:policy-violation; sid:930002; rev:1; )
alert file ( msg:"INDICATOR-PACKED Titan packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"|2E 74 69 74 61 6E 00 00|",nocase,fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_Titan"; classtype:policy-violation; sid:930003; rev:1; )
alert file ( msg:"INDICATOR-PACKED AspireCrypt packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"protected by AspireCrypt",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_AspireCrypt"; classtype:policy-violation; sid:930004; rev:1; )
alert file ( msg:"INDICATOR-PACKED ConfuserEx packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"ConfuserEx",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_ConfuserEx"; classtype:policy-violation; sid:930005; rev:1; )
alert file ( msg:"INDICATOR-PACKED ConfuserEx packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"ConfusedByAttribute",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_ConfuserEx"; classtype:policy-violation; sid:930006; rev:1; )
alert file ( msg:"INDICATOR-PACKED ConfuserExMod BedsProtector packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"Beds Protector",nocase,fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_ConfuserExMod_BedsProtector"; classtype:policy-violation; sid:930007; rev:1; )
alert file ( msg:"INDICATOR-PACKED ConfuserExMod BedsProtector packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"Beds-Protector",nocase,fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_ConfuserExMod_BedsProtector"; classtype:policy-violation; sid:930008; rev:1; )
alert file ( msg:"INDICATOR-PACKED ConfuserExMod Trinity packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"TrinityProtector",nocase,fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_ConfuserExMod_Trinity"; classtype:policy-violation; sid:930009; rev:1; )
alert file ( msg:"INDICATOR-PACKED ConfuserExMod Trinity packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"Trinity0-protecor",nocase,fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_ConfuserExMod_Trinity"; classtype:policy-violation; sid:930010; rev:1; )
alert file ( msg:"INDICATOR-PACKED MPRESS packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:".MPRESS",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_MPress"; classtype:policy-violation; sid:930011; rev:1; )
alert file ( msg:"INDICATOR-PACKED Nate packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:".nate",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_Nate"; classtype:policy-violation; sid:930012; rev:1; )
alert file ( msg:"INDICATOR-PACKED BoxedApp packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:".bxpck",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_BoxedApp"; classtype:policy-violation; sid:930013; rev:1; )
alert file ( msg:"INDICATOR-PACKED BoxedApp packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"BoxedAppSDK_HookFunction",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_BoxedApp"; classtype:policy-violation; sid:930014; rev:1; )
alert file ( msg:"INDICATOR-PACKED eXPressor packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:".ex_cod",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_eXPressor"; classtype:policy-violation; sid:930015; rev:1; )
alert file ( msg:"INDICATOR-PACKED eXPressor packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"eXPressor_InstanceChecker_",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_eXPressor"; classtype:policy-violation; sid:930016; rev:1; )
alert file ( msg:"INDICATOR-PACKED VMProtect packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:".vmp",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_VMProtect"; classtype:policy-violation; sid:930017; rev:1; )
alert file ( msg:"INDICATOR-PACKED Engima packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:".enigma",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_Enigma"; classtype:policy-violation; sid:930018; rev:1; )
alert file ( msg:"INDICATOR-PACKED LibZ packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"LibZ.Injected",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_LibZ"; classtype:policy-violation; sid:930019; rev:1; )
alert file ( msg:"INDICATOR-PACKED LibZ packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"asmz://",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_LibZ"; classtype:policy-violation; sid:930020; rev:1; )
alert file ( msg:"INDICATOR-PACKED LSD packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"the LSD executable packer",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_EXE_Packed_LSD"; classtype:policy-violation; sid:930021; rev:1; )
alert file ( msg:"INDICATOR-PACKED EXE2MSI-free packed executable file transfer detected"; file_type:"MSOLE2"; file_data; content:"Exe to msi converter free",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_MSI_EXE2MSI"; classtype:policy-violation; sid:930022; rev:1; )
alert file ( msg:"INDICATOR-PACKED RLPack packed executable file transfer detected"; file_type:"MSEXE"; file_data; content:"|2E 52 4C 50 61 63 6B 00|",fast_pattern; service:http, smtp; rem:"yara:INDICATOR_MSI_EXE2MSI"; classtype:policy-violation; sid:930023; rev:1; )
################################################
# INDICATOR SUSPICIOUS
################################################
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS ( msg:"INDICATOR-OBFUSCATION Spoofed Host header"; flow:to_server,established; http_header:field host; content:"127.0.0.1",fast_pattern; metadata:ruleset community, service http; classtype:misc-activity; sid:940060; rev:1; )
alert http $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any ( msg:"INDICATOR-OBFUSCATION Encoded executable download detected - AlienCrypter"; flow:to_client,established; file_data; content:"</p><p>@@@77,90,",fast_pattern; metadata:ruleset community, service http; classtype:trojan-activity; sid:940061; rev:1; )
alert http $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any ( msg:"INDICATOR-OBFUSCATION Encoded executable download detected - AlienCrypter"; flow:to_client,established; file_data; content:"</p><p>@@@HH,JA,",fast_pattern; metadata:ruleset community, service http; classtype:trojan-activity; sid:940062; rev:1; )